# PrÃ¡ctica Calidad Software - Grupo 7

# Miembros del grupo
| Nombre y apellidos | Email urjc | Nickname GitHub |
|:-----------------|:-----:|-------:|
| **Olga Chubinova Bortsova**    | o.chubinova.2022@alumnos.urjc.es | chubi0l |
| **Elinee Freites**    | en.freites.2022@alumnos.urjc.es | ElineeF |
| **Andrea Garrobo GuzmÃ¡n**    | a.garrobo.2022@alumnos.urjc.es | Garrobo08 |
| **Jordi Guix Betancor**    | j.guix.2023@alumnos.urjc.es | jordigb44 |

# ğŸ”— Github Repository URL 
https://github.com/chubi0l/calidad-software-2025-grupo-7

# ğŸ”— Azure Production URL
**Production:** http://nitflex-production.spaincentral.azurecontainer.io:8080
**Staging** http://nitflex-staging.spaincentral.azurecontainer.io:8080

## ğŸ–¥ï¸ Screenshots
# TODO

# Practise 1
## Olga Chubinova Bortsova
| Commit | Description |
| :----: | :---------: |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/3e2a27ec50f6b3e2d26b0e7de6682be611e268f3) | Task 1 (Test Unitario) |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/2e0db2f91bc79ae81d9f9a14c2b4bce2573f8f8f) | Task 2 (Test de IntegraciÃ³n con BBDD) |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/32d73e8df0a5648f16f3258ca3f65c101027aa11) | Task 3 (Test de sistemas web - Selenium) |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/699e5f397d67ed7f3564f4c3cf5c5fa62923b90e) | Task 4 (Test de sistemas Rest) |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/173509a46e60b805e0cac953f8ccfa67cf0f1183) | Artillery Test | 
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/ffc8b3d180b915db0f5df23d8d262ce2e9ab02dd) | Cobertura Jacoco |


## Jordi Guix Betancor
| Commit | Description |
| :----: | :---------: |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/9d0b562343c25d3fc28510d0c53e1421e060d88e) | Task 2 (Test Unitario) |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/c5111c44b52609500c805e5c2011185ba06e72ba) | Task 3 (Test de IntegraciÃ³n con BBDD) |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/93c66c3c998597beb8c929101113c8a2f38b5c02) | Task 4 (Test de sistemas web - Selenium) |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/8385d76cf56c417ae3491401a8cdda3c9fd5b35d) | Task 1 (Test de sistemas Rest) |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/c56167eafc2af5cb146dc0b7a5ca416099b9d5b2) | Artillery Test |


## Elinee Nathalie freites MuÃ±oz
| Commit | Description |
| :----: | :---------: |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/d02c718f579ca7fb7334026434a3a0699ec909d2) | Task 4 Ttest Unitario |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/d02c718f579ca7fb7334026434a3a0699ec909d2) | Task 1 (Test de IntegraciÃ³n con BBDD) |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/9c167b09bd6799bc8a6116c03d8233fbda1458f2) | Task 2 (Test de sistemas web - Selenium) |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/ed49dc75f653b9581d2e726d446a50de4a569a52) | Task 3 (Test de sistemas Rest) |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/08112a0fe91c256cc689d05092f377fc94ec1254) | Artillery Test |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/ffc8b3d180b915db0f5df23d8d262ce2e9ab02dd) | Cobertura Jacoco |

## Andrea Garrobo GuzmÃ¡n
| Commit | Description |
| :----: | :---------: |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/890668abfe9d13d21e79e9cad564e2a55a721b85) | Task 3 - Test Unit |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/5747d956b66760d1c5b4bb4aa71b5691cf753600) | Task 4 - Test Integration |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/c438b79a41a8b54aa19f814adb34b3e4770983ae) | Task 1 - Selenium Web Test |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/ac2a3b51c9cad6a2cf9206b64af91dd894af59d2) | Task 2 - Test  rest |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/08112a0fe91c256cc689d05092f377fc94ec1254) | Artillery Test |
| [Link](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/ffc8b3d180b915db0f5df23d8d262ce2e9ab02dd) | Cobertura Jacoco |



# Practise 2
## ğŸ‘¥ Task Assignment
The following outlines the contribution of each team member to the project:
- **[Olga Chubinova Bortsova]**
  - Actively contributed to the implementation and configuration of the **four GitHub Actions workflows**:
  - Also implemented the Smoke Test and the Selenium Test for the multibrowser
  - Responsible for **fix-1**, which involved:
    - Fixing the malfunction of the **"Cancel"** button on the "Create New Movie" page (it was not returning to the "All Movies" page).
    - Adding a **regression test using Selenium** to verify that users can successfully navigate back to the list of all movies.
    - Simulating the development and maintenance of the Nitflex application using the **existing CI workflows** and following the **GitHub Flow** development model.
  - Fully organized and wrote the **project readme**.

- **[Jordi Guix Betancor]**
  - Actively contributed to the implementation and configuration of the **four GitHub Actions workflows**
  - Responsible for **feature-1**, which involved:
    - Implementing validation for movie release year (must be >= 1895)
    - Adding error handling and user notification when invalid year is entered
    - Creating unit tests to verify year validation logic
    - Implementing Selenium E2E tests to ensure proper error display
    - Following the GitHub Flow model for feature development
    - Ensuring proper error messages display in the frontend
  - The implementation included:
    - Adding validation in FilmService
    - Creating comprehensive test coverage
    - Handling error display in the web interface
    - Maintaining consistency across the application

- **[Elinee Nathalie freites MuÃ±oz]**
  - I have collaborated in workflows 1, 2, and 3. Additionally, I was responsible for refactoring task 1, which consisted of using SonarQube locally to identify code smells.
    - Following the guidelines provided by the tool, I corrected each detected code smell, making a separate commit for each correction in the corresponding branch.
    - Info-level code smells were ignored.
    - In the pull request, I documented which code smells were not fixed because they were considered false positives.

- **[Andrea Garrobo GuzmÃ¡n]**
  - I was responsible for fix task 2.
    - It was detected that the DatabaseInitializer was not using the correct method to load images, which caused the sample movies to appear without a photo when deployed on Azure, as it attempted to load images       from the local file system.
    - To resolve this issue, I modified the class to load images from a URL instead, using the methods provided by ImageUtils.




## ğŸ”„ Steps Followed
The following outlines the steps followed to apply the fix for the Cancel button issue and deploy it using GitHub Flow and CI/CD pipelines.

- **[STEP 1 - Olga Chubinova Bortsova]**
### ğŸ› ï¸ Fix Implemented
- In the movie creation template (`filmForm.html`), the Cancel button originally redirected to a non-functional path:
  ```html
  <button class="ui button" onclick="location.href='/films/{{film.id}}'; return false;">Cancel</button>
  ```
- This was changed to:
  ```html
  <button class="ui button" onclick="location.href='/'; return false;">Cancel</button>
  ```
  This update ensures the Cancel button correctly redirects users back to the **home page**, where the list of films is displayed.

- A **Selenium regression test** was added to an existing test class to verify this behavior:
  ```java
  @Test
  @DisplayName("Cancel button from new film page navigates back to film list")
  void testCancelFromNewFilmForm() {
      driver.get("http://localhost:" + port + "/films/new");

      WebElement cancelButton = wait.until(ExpectedConditions.elementToBeClickable(By.xpath("//button[text()='Cancel']")));
      cancelButton.click();

      wait.until(ExpectedConditions.urlToBe("http://localhost:" + port + "/"));
      WebElement createButton = wait.until(ExpectedConditions.presenceOfElementLocated(By.id("create-film")));

      assertTrue(createButton.isDisplayed(), "Expected to be on the homepage after canceling, but we are not.");
  }
  ```
### ğŸ”§ Git Commands Used
The following Git commands were used throughout the development and deployment of the fix:
```bash
# Create a new branch (This branch was created in the beggining of the proyect)
git checkout -b fix-1
# Stage and commit the changes
git add .
git commit -m "cancel button in new film form fixed"
# Push the branch to GitHub
git push origin fix-1
```
A pull request was opened on GitHub from `fix-1` to `main`, reviewed, and approved. After approval, the branch was succesfully merged.
```bash
# Switch to the main branch
git checkout main
# Merge the fix branch
git merge fix-1
# Push the updated main branch to GitHub
git push origin main
```
### âš™ï¸ Triggered Workflows
Once merged into `main`, the following workflows were automatically triggered by GitHub Actions:
- âœ… [Workflow 2](https://github.com/chubi0l/calidad-software-2025-grupo-7/actions/runs/15252109117)
- âœ… [Workflow 3](https://github.com/chubi0l/calidad-software-2025-grupo-7/actions/runs/15252259279)
- âœ… [Workflow 4](https://github.com/chubi0l/calidad-software-2025-grupo-7/actions/runs/15252613498)

### ğŸ³ Docker Image
The Docker image built during this process is published on Docker Hub with the corresponding tag:
- [chubi0l/nitflex:1.0.1](https://hub.docker.com/) TODO

### ğŸŒ Staging Deployment
![Cancel Button Working](captures/) TODO


- **[STEP 2 - Jordi Guix Betancor]**
#### ğŸ› ï¸ Feature Implemented (feature-1)
- Added year validation in `FilmService.java`:
  ```java
  public FilmDTO save(CreateFilmRequest film, Blob imageField) {
      if (film.releaseYear() < 1895) {
          throw new IllegalArgumentException("The release year must be greater than or equal to 1895");
      }
      // ...existing code...
  }
  ```

- Added unit test to verify the validation:
  ```java
  @Test
  @DisplayName("Cuando se guarda una pelÃ­cula con un aÃ±o anterior a 1895, NO se guarda en el repositorio y se lanza una excepciÃ³n")
  void testSaveFilmWithInvalidYear() {
      //GIVEN
      CreateFilmRequest invalidFilm = new CreateFilmRequest(
          "PelÃ­cula antigua", 
          "Una pelÃ­cula muy antigua", 
          1894,  // AÃ±o invÃ¡lido
          "+12"
      );

      //WHEN & THEN
      assertThrows(IllegalArgumentException.class, () -> {
          filmService.save(invalidFilm);
      }, "The release year must be greater than or equal to 1895");

      verify(filmRepository, never()).save(any(Film.class));
  }
  ```

- Added Selenium E2E test to verify error display:
  ```java
  @Test
  @DisplayName("Cuando se intenta crear una pelÃ­cula con aÃ±o anterior a 1895, se muestra error y no se crea la pelÃ­cula")
  void testAddFilmWithInvalidYear() {
      // ...setup code...
      addFilm("PelÃ­cula Test AÃ±o InvÃ¡lido", FILM_DESCRIPTION, "1894", "+12", null);
      
      WebElement errorMessage = wait.until(ExpectedConditions.presenceOfElementLocated(By.id("message")));
      assertEquals("The release year must be greater than or equal to 1895", 
          errorMessage.getText().trim());
  }
  ```

- Modified error handling in `FilmWebController.java`:
  ```java
  @PostMapping("/films/new")
  public String newFilmProcess(CreateFilmRequest film, MultipartFile imageField, Model model) {
      FilmDTO newFilm = null;
      try {
          newFilm = filmService.save(film, imageField);
      } catch(IllegalArgumentException e) {
          model.addAttribute("error", true);
          model.addAttribute("message", e.getMessage());
          return "error";
      }
      return "redirect:/films/" + newFilm.id();
  }
  ```

#### ğŸ”§ Git Commands Used
```bash
# Create feature branch
git checkout -b feature-1

# Stage and commit changes
git add .
git commit -m "feat: add validation for movie release year (>= 1895)"

# Push to GitHub
git push origin feature-1
```
Note: During the push, I did a ```git revert 5ab7daf``` since my first push hadn't selected the feature-1 branch, so it was pushed to the main branch. To fix the error, I had to run that command to restore the main branch to its previous state before incorporating my incorrect commit.

#### âš™ï¸ Triggered Workflows
Before merging into `main`, the following workflows were triggered:
- âœ… [Workflow 2](https://github.com/chubi0l/calidad-software-2025-grupo-7/actions/runs/15253443133)

- [Revert](https://github.com/chubi0l/calidad-software-2025-grupo-7/commit/665ebf3d0f192ef66cb69befee4099592019ebfd)

After merging into `main`, the following workflows were triggered:
- âœ… [Workflow 3](https://github.com/chubi0l/calidad-software-2025-grupo-7/actions/runs/15253551300)
- âœ… [Workflow 4](https://github.com/chubi0l/calidad-software-2025-grupo-7/actions/runs/15253551302)

#### ğŸŒ Feature Verification
![Year Validation Error](captures/year-validation-error.png)





# ğŸ§ª Workflow 4 - Nightly Testing & Staging Deployment
This workflow runs exhaustive tests, builds and deploys the **Nitflex** application nightly, and tags the Docker image as `nitflex-nightly` along with the deployment date.
---

## ğŸš€ When does it run?
This workflow is triggered automatically in the following cases:

- â° **Every night at 2:00 AM UTC** (`cron: '0 2 * * *'`)
- ğŸ§‘â€ğŸ’» **Manually** via `workflow_dispatch` (from GitHub Actions)
- âœ… **On push to `main`**, except when only the following files change:
  - `.github/workflows/**`
  - `README.md`
---

## ğŸ”§ What does this workflow do?
### 1. `multibrowser` â€“ E2E Testing on Multiple Browsers
Runs Selenium tests in the following environments:
| Operating System | Browsers              |
|------------------|------------------------|
| Ubuntu           | Chrome, Firefox        |
| Windows          | Chrome, Firefox, Edge  |
| macOS            | Chrome, Firefox, Safari |

ğŸ‘‰ Executes the class: `TestSeleniumMultibrowser`
---

### 2. `loadtesting` â€“ Testing and Deployment to Azure (Staging)
Performs the following steps:
- âœ… Runs tests:
  - Unit tests: `es.codeurjc.web.nitflex.unit.**.*`
  - Integration tests: `es.codeurjc.web.nitflex.integration.**.*`
  - System tests (excluding multibrowser): `es.codeurjc.web.nitflex.e2e.**.*`
- ğŸ³ Builds and pushes the Docker image tagged with the commit SHA (`${{ github.sha }}`)
- â˜ï¸ Automatically deploys to Azure Container Instances (staging)
- ğŸ“ˆ Runs Artillery tests:
  - Smoke test: `artillery/smoke-test.yml`
  - Load test: `artillery/load-test.yml`
---

### 3. `tag-nightly` â€“ Etiquetado de imagen como nitflex-nightly
Si los jobs anteriores finalizan correctamente:
- ğŸ”„ Hace `pull` de la imagen Docker generada (`${{ github.sha }}`)
- ğŸ· La vuelve a etiquetar como: `nitflex:nightly-YYYY-MM-DD`
- ğŸ“¤ La sube nuevamente a Docker Hub
---




## ğŸ”— Ãšltima ejecuciÃ³n del workflow
TODO
---

## ğŸ“¦ Artefactos generados
- ğŸ”§ Imagen Docker: [`docker pull jordigb44243/nitflex:nightly-2025-05-26`](https://hub.docker.com/layers/jordigb44243/nitflex/nightly-2025-05-26/images/sha256-6a678dd6ee44035b25a5bf6d141a8d203eac1574d7539142afd7b99eea7a01b6)
- â˜ï¸ Contenedor en Azure: [`nitflex-staging.spaincentral.azurecontainer.io:8080`](http://nitflex-staging.spaincentral.azurecontainer.io:8080/)
- ğŸ“„ No se generan artefactos `.zip` o `.jar`, ya que el resultado es la imagen desplegable.
---
